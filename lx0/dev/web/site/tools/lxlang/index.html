<!DOCTYPE html>
<html>
    <head>
      <title>LxLang</title>
      <link type="text/css" href="../shared/style/default.less" rel="stylesheet/less" />
      <link type="text/css" href="style.less" rel="stylesheet/less" />
      
      <script type="text/javascript" src="../shared/script/extern/less-1.1.3.min.js"></script>
      <script type="text/javascript" src="../shared/script/extern/jquery-1.6.4.min.js"></script>

    </head>
    <body>
       <div id="body-wrap1">
        <h1>LxLang</h1>

        <h2>About</h2>

        <p>
          LxLang is an experimental language designed to support the rapid development of
          low-level "building block" function libraries that can be compiled to Javascript,
          C++, and GLSL.  It supports named functions, POD data types, function and operator
          overloading.  It also supports a limited set of special variables and shorthand
          constructs useful in the low-level function domain.
        </p>
        <p>
          The language is <i>not</i> designed to be fully general purpose: it does not, nor
          are there any plans to, support complex data types or general object-oriented
          programming concepts such as inheritance.  The output libraries of LxLang provide
          useful building block functionality upon which to build higher-level, language-specific
          constructs.
        </p>
        <p>
          The goal of LxLang is to aid in designing short and efficient functions and simple 
          primitive data types.
        </p>
        <p>
          <strong><em>Currently in development</em></strong>
        </p>

        <h2>Demonstration</h2>
        <script id="source" type="text/lxlang">
module lx.glgeom;
        
function dot (vec3 u, vec3 v) -> vec3
{
  return u[0] * v[0] + u[1] * v[1] + u[2] * v[2];
}

function length (vec3 u) -> var
{
  return sqrt( dot(u, u) );
}
        </script>
 
        <style>
        .codeview { padding: 0em 2em; border: 1px solid #CCC; border-radius: .5em; font-family: Monospace; font-size: 9pt; min-height: 6em; }
        </style>
 
        <h3>Source</h3>
        <div id="view" class="codeview"></div>

        <h3>Generated Javascript</h3>
        <div id="Div1" class="codeview"></div>

        <h3>Generated C++</h3>
        <div id="Div2" class="codeview"></div>

        <h3>Generated GLSL</h3>
        <div id="Div3" class="codeview"></div>
  

        <script type="text/javascript">
        <!--

          var Context = function(text) 
          {
              this.source = text;
          };
          Context.prototype.empty = function()
          {
            return this.source.length == 0;
          };
          Context.prototype.skipWhitespace = function()
          {
            this.source = this.source.replace(/^\s+/, "");
          };
          Context.prototype.parseText = function(text, consume)
          {
            if (this.source.substr(0, text.length) == text) {
              if (consume)
                this.source = this.source.substr(text.length);
              return text;
            }
            else
              throw "Did not find expected text: '" + text + "' around '" + this.source.substr(0, 80) + "'";
          };
          Context.prototype.parseRE = function(name, re, consume)
          {
            var m;
            if (m = this.source.match(re)) {
              if (consume)
                this.source = this.source.substr(m[0].length);
              return m[0];
            }
            else
              throw "Expected "+ name + " at '" + this.source.substr(0, 80) + "'";  
          };
          Context.prototype._RETable = 
          {
            ws : /^\s+/,
            name : /^[_A-Za-z][_A-Za-z0-9]*/,
            complexName : /^[_A-Za-z][_A-Za-z0-9\.]*/,
          };
          Context.prototype._parseWorker = function(type, consume)
          {
            var optional = type.match(/\?$/);
            if (optional)
              type = type.substr(0, type.length - 1);

            try 
            {
              if (type.substr(0,1) == "@")
              {
                var re = this._RETable[type.substr(1)];
                return this.parseRE(type, re, consume);
              }
              else {
                return this.parseText(type, consume);
              }
            } catch (e)
            {
              if (!optional)
                throw e;
            }
          };
          Context.prototype._parseWorker2 = function(types, consume)
          {
              var a = [];
              for (var i = 0; i < types.length; ++i)
                a[i] = this._parseWorker(types[i], consume);
              return a;
          };
          Context.prototype.skip = function(type)
          {
            // This is not the best method of implementation for 'skip'!
            try {
              this._parseWorker(type, true);
            } catch (e) 
            {
            }
          };
          Context.prototype.consume = function()
          {
              return this._parseWorker2(arguments, true);
          };
          Context.prototype.peek = function()
          {
            try {
              return this._parseWorker2(arguments, false);
              } catch(e) {}
          };

         

          var Parser = function () { 
            this._module = null;
            this._functions = [];
          };

          var methods =
          {
            parseModule : function(ctx)
            {
                this._module = ctx.consume("module", "@ws", "@complexName")[2];
                ctx.skip("@ws");
                ctx.consume(";");
            },

            parseArg : function (ctx)
            {
              var arg = {};
              arg.type = ctx.consume("@name", "@ws")[0];
              arg.name = ctx.consume("@name", "@ws?")[0];
              return arg;
            },

            parseStatementSet : function (ctx)
            {
              
            },

            parseFunction : function(ctx)
            {
              var f = {};
              f.args = [];
              f.name = ctx.consume("function", "@ws", "@name", "@ws?", "(")[2];
              ctx.consume("@ws?");
              while (!ctx.peek(")")) {
                f.args.push( this.parseArg(ctx) );
                if (ctx.peek(",")) {
                  ctx.consume(",");
                  ctx.consume("@ws?");
                }
              };
              ctx.consume(")");

              ctx.consume("@ws?", "->", "@ws?");
              f.returnType = ctx.consume("@name", "@ws?")[0];
              ctx.consume("{", "@ws?");
              ctx.consume("}");

              this._functions.push(f);
            },

            parseDefinition : function(ctx)
            {
              while (!ctx.empty())
              {
                var keyword = ctx.peek("@name")[0];
                switch (keyword)
                {
                case "function":
                  this.parseFunction(ctx);
                  break;
                default: 
                  throw "Unrecognized keyword '" + keyword + "' around '" + ctx.source.substr(0, 80)+ "'";
                }
                ctx.consume("@ws?");
              }
            },

            parse : function (text) {
              var ctx = new Context(text);

              ctx.skip("@ws");
              this.parseModule(ctx);
              ctx.skip("@ws");
              this.parseDefinition(ctx);
            },
          };

          for (var key in methods)
            Parser.prototype[key] = methods[key];

          $(document).ready(function () {

            $("#view").css("white-space", "pre");
            $("#view").text($("#source").text());
            var parser = new Parser();
            parser.parse($("#source").text());
            console.log(JSON.stringify(parser));
          });
        -->
        </script>

        <!-- Google Analytics -->         <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-604613-10']);
            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();        </script> 

    </body>
</html>
