<!DOCTYPE html>
<html>
    <head>
      <title>Patterns</title>
      <link type="text/css" href="../shared/style/default.less" rel="stylesheet/less" />
      <link type="text/css" href="style.less" rel="stylesheet/less" />

      <script src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>
      <link rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/github.css">
      
      <script type="text/javascript" src="../shared/script/extern/less-1.1.3.min.js"></script>
      <script type="text/javascript" src="../shared/script/extern/jquery-1.6.4.min.js"></script>
      <script type="text/javascript" src="../shared/script/extern/jquery.cookie.js"></script>
      <script type="text/javascript">
      <!--
        var scriptFiles = [ 
          "../shared/script/lx.core-0.1.1.js",
          "../shared/script/lx.vec.js",
          "../shared/script/lx.webUtil-0.1.0.js",
          "../shared/script/jquery.lx.seamlessImage-current.js",
          "lx.patterns.js",
          "../lxlang/lxlang.js",
        ];
        for (var i in scriptFiles) {
          var s = "<script type='text/javascript' src='";
          s += scriptFiles[i] + "?rand=" + Math.random();
          s += "'></script>";
          document.writeln(s);
        }
      -->
      </script>

    </head>
    <body>
       <div id="body-wrap1">
        <h1>Patterns</h1>

        <h2>About</h2>
        <div class="layout-row">
          <div style="max-width: 40em">
            <p>
                A collection of pattern functions primarily designed for creating procedurals with the ShaderBuilder.
            </p>
            <p>
              <strong>Download</strong> <a href="lx.patterns.js">lx.patterns.js</a>.
            </p>
            <p>
              (The patterns below are all dynamically generated with multi-sampling. The pattern images then use
              the <a href="../seamlessImage">JQuery seamless image plug-in</a> to animate and allow user control over 
              zooming in and out on the pattern.)
            </p>
            <p>
              <strong>Color scheme:</strong>
                <select id="colorScheme">
                  <option selected value="[0,0,0]|[255,255,255]">black &amp; white</option>
                  <option value="[255,255,255]|[0,0,0]">white &amp; black</option>
                  <option value="[206,40,40]|[249,217,95]">red &amp; gold</option>
                  <option value="[13,50,55]|[45,176,59]">blue &amp; green</option>
                </select>
            </p>
          </div>
            <div>
                <div style="border: 1px solid #CCC; border-radius: 6px; padding: 8px 2em 8px 8px;  width: 12em; margin-left: 2em">
                    <strong style="color: #777">Table of Contents</strong>
                    <div id="toc"></div>
                </div>
            </div>  
        </div>

        <div id="pattern-template" style="display: none">
          <h3 class="pattern-name"></h3>
          <div  class="layout-row">
              <div>
                  <canvas class="pattern" width="256" height="256" data-pattern="return lx.patterns.test(uv);"></canvas>
              </div>
              <div><div class="source" data-function="lx.patterns.test"></div></div>
          </div>
        </div>

        <h2>Example</h2>
        <p>Example of a complex pattern.</p>
        <div id="example"></div>
        

        <h2>Basic Patterns</h2>
        <div id="basic"></div>

        <h2>Variation Patterns</h2>
        <div id="variation"></div>

        <h2>Compound Patterns</h2>
        <div id="compound"></div>

        <h2>Miscellaneous Patterns</h2>
        <div id="misc"></div>

        <h2>Complex Patterns</h2>
        <div id="complex"></div>

        <h2>Sandbox Patterns</h2>
        <div id="sandbox"></div>

        <h2>Future Work</h2>
        <ul>
          <li>Rewrite pattern functions in LxLang (i.e. GLSL)</li>
          <li>Parameterization of patterns</li>
          <li>Color patterns (gradients, etc.)</li>
        </ul>

        <script type="text/javascript">
        <!--

          var white = [ 0, 0, 0 ];
          var black = [ 255, 255, 255 ];

          function checkCookies()
          {
            var scheme = $.cookie('colorScheme');
            if (scheme)
            {
              $("#colorScheme").val(scheme);
              var arr = scheme.split('|');
              eval("white = " + arr[0] + ";");
              eval("black = " + arr[1] + ";");
            }
          }

          (function ($) {

              var util =
              {
                drawRow : function (ctx, y, func)
                {
                    var rowData = ctx.createImageData(this.width, 1);
                    var pixels = rowData.data;
                    for (var x = 0; x < this.width; ++x) {

                      var uv = [
                        (x / (this.width)),
                        (y / (this.height)),
                        0
                      ];
                      
                      var dx = (.5 / this.width);
                      var dy = (.5 / this.height);

                      var g = 2 * func(uv);
                      g += func([uv[0] - dx, uv[1] - dy, 0]);
                      g += func([uv[0] + dx, uv[1] - dy, 0]);
                      g += func([uv[0] + dx, uv[1] + dy, 0]);
                      g += func([uv[0] - dx, uv[1] + dy, 0]);
                      g += func([uv[0] - dx, uv[1], 0]);
                      g += func([uv[0] + dx, uv[1], 0]);
                      g += func([uv[0], uv[1] + dy, 0]);
                      g += func([uv[0], uv[1] + dy, 0]);
                      g /= 10;
                      
                      var c = [0, 0, 0];
                      if (g >= 0 && g <= 1) {
                        var gp = Math.max(Math.min(g, 1), 0);
                        for (var i = 0; i < 3; ++i)
                          c[i] = Math.floor(lx.core.blend(black[i], white[i], gp));
                      }
                      else if (g == NaN) {
                        c = [255, 0, 255];
                      }
                      else if (g === undefined) {
                        c = [255, 255, 0];
                      }
                      else if (g === Infinity || g === -Infinity) {
                        c = [0, 255, 255];
                      }
                      else {
                        c = [255, 0, 0];
                      }

                      pixels[x * 4 + 0] = c[0];
                      pixels[x * 4 + 1] = c[1];
                      pixels[x * 4 + 2] = c[2];
                      pixels[x * 4 + 3] = 255;
                    }
                    ctx.putImageData(rowData, 0, y);
                },
              };

              var methods =
              {

                draw : function(options)
                {
                  var _this = this;
                  var func = options.func;
                  var dataFunc = $(this).attr("data-pattern");
                  if (dataFunc)
                    eval("func = function(uv) { " + dataFunc + " };");

                  var ctx = this.getContext('2d');
                  var tasks = [];
                  for (var y = 0; y < this.height; ++y) {
                    var task = (function(y) { return function() { util.drawRow.call(_this, ctx, y, func); } })(y); 
                    tasks.push(task);
                  }

                  tasks.push( function() { $(_this).seamlessImage({ sliderMax : 8, count : 5 }); } );

                  lx.core.run_tasks(tasks, 0, { groupSize: 4 });
                },
              };


              $.fn.pattern = function (options) {

                options = $.extend({}, options);
                
                return this.each(function () {
                  methods.draw.call(this, options);
                });
              };
            })(jQuery);

            function showPatterns(section, names)
            {
              $.each(names, function(i, value) {
                var div = $("#pattern-template").clone();
                div.attr("id", "");
                div.find(".pattern-name").text(value);
                div.find(".pattern").attr("data-pattern", "return lx.patterns." + value + "(uv);");
                div.find(".source").attr("data-function", "lx.patterns." + value);
                $(section).append(div);
                div.show();
              });
            }

            function loadLxLang()
            {
                var parser2 = new lxlang2.Parser();
                var genJs = new lxlang2.GenerateJavascript();

                $.ajax("../shared/script/lx.vec.lxlang" + "?rand=" + Math.random(), {
                    dataType : "text",
                    async : false,
                    success : function(text) {
                                                    
                            var ast = parser2.parse(text);
                            var code = genJs.translate(ast);
                            console.log(code);
                            eval(code);
                            //eval(jsname + ".source = text;");
                        
                    },
                });
            }


            $(document).ready(function () {
 
              loadLxLang();
              checkCookies();

              $("#colorScheme").change(function() {
                var scheme = $(this).val();
                $.cookie('colorScheme', scheme);
                window.location.reload(true);
              });

              showPatterns("#example", [ "weave" ]);
              showPatterns("#basic", ["checker", "spot", "tile", "diamond", "wave" ]);
              showPatterns("#variation", [ "ribbon" ]);
              showPatterns("#compound", "spotwave, spotdiamondxor".split(","));
              showPatterns("#misc", [ "star", "misc1" ]);
              showPatterns("#complex", [ "weave" ]);
              showPatterns("#sandbox", [ "test" ]);

              $("#toc").tableOfContents();

              window.setTimeout(function() { $(".pattern").pattern(); }, 500);
              $(".source").includeSource();

            });
        -->
        </script>

        <!-- Google Analytics -->         <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-604613-10']);
            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();        </script> 

    </body>
</html>
