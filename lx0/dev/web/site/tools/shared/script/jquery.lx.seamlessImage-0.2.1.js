(function(b){var l={init:function(a,g){if("CANVAS"==a.tagName){var d=b("<img/>"),e=a.toDataURL("image/png");d.attr("src",e);d.attr("style",b(a).attr("style"));d.attr("class",b(a).attr("class"));d.attr("width",a.width);d.attr("height",a.height);b(a).replaceWith(d);a=d[0]}else if("IMG"!=a.tagName){console.log("Warning: seamlessImage only works for IMG and CANVAS elements");return}var h=b(a).attr("src"),d=new Image;d.onload=function(){var c=b("<canvas/>");c.attr("width",a.width);c.attr("height",a.height);
c.attr("style",b(a).attr("style"));c.attr("class",b(a).attr("class"));var f={count:parseFloat(g.count),rotation:parseFloat(g.rotation),image:d,allowAnimate:!0,onDraw:[]};b.data(c,"seamlessImage",f);var e=c;if(g.link){var k=b("<a/>");k.attr("href",h);k.attr("target","_blank");k.append(e);e=k}if(g.ui){k=b("<div/>");k.append(e);var m=b("<div/>"),j,i;m.css("width",d.width+"px");i=b("<input/>");i.attr("type","range");i.attr("min",-180);i.attr("max",180);i.attr("value",0);i.attr("step",1);i.css("width",
"32px");i.css("height",a.height+"px");i.css("-webkit-appearance","slider-vertical");i.css("float","left");e.css("float","left");e.after(i);j=b("<input/>");j.attr("type","range");j.attr("min",25);j.attr("max",100*g.sliderMax);j.attr("value",100);j.attr("step",1);j.css("width",a.width+"px");m.append(j);var n=b("<div/>");n.css("text-align","center");n.css("font-size","80%");m.append(n);k.append(m);j.change(function(){f.allowAnimate=!1;f.count=parseFloat(b(this).val())/100;l.draw(c)});i.change(function(){f.allowAnimate=
!1;f.rotation=parseFloat(b(this).val());l.draw(c)});f.onDraw.push(function(){var a=b.data(c,"seamlessImage").count;n.text(Math.floor(100*a)/100);j.val(100*a)});e=k}b(a).replaceWith(e);if(g.animate){var o=f.count;f.count=1;var p=function(){var a=o-f.count;0.01<Math.abs(a)&&f.allowAnimate?(a=0>a?Math.max(a,-0.05):Math.min(a,0.05),f.count+=a,l.draw(c),setTimeout(p,50)):(f.count=o,l.draw(c))};l.draw(c);setTimeout(p,750)}else l.draw(c)};d.src=h},draw:function(a){var g=b.data(a,"seamlessImage"),d=1/g.count,
e=g.image,h=a[0].getContext("2d");h.clearRect(0,0,a[0].width,a[0].height);h.save();h.translate(e.width/2,e.height/2);h.scale(d,d);h.rotate(g.rotation*Math.PI/180);var c=h.createPattern(e,"repeat"),f=a[0].width/2,a=a[0].height/2;h.translate(f,a);h.fillStyle=c;h.fillRect(-e.width/d-f,-e.height/d-a,2*e.width/d,2*e.height/d);h.restore();b.each(g.onDraw,function(a,b){b()})}};b.fn.seamlessImage=function(a,g){var d=a;"string"==typeof a&&(d=g);var e=b.extend({count:1,sliderMax:4,rotation:0,ui:!0,animate:!0,
link:!0},d);return this.each(function(){var a=e,c=b(this).attr("data-seamlessImage");if(c)try{c=lx.color.lib._trim(c),"{"!=c[0]&&(c="{ "+c+" }"),eval("params = "+c+";"),a=b.extend({},a,c)}catch(d){}l.init(this,a)})};(function(){var a=document.createElement("input");a.setAttribute("type","range");return"range"==a.type})()||(b.fn.seamlessImage=function(){})})(jQuery);