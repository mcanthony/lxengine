<!DOCTYPE html>
<html>
    <head>
      <title>LxWeb Prototype</title>
      <link type="text/css" href="../shared/style/default.less" rel="stylesheet/less" />
      <link type="text/css" href="style.less" rel="stylesheet/less" />
      
      <script type="text/javascript" src="../shared/script/extern/less-1.1.3.min.js"></script>
      <script type="text/javascript" src="../shared/script/extern/jquery-1.6.4.min.js"></script>
    </head>
    <body>
       <div id="body-wrap1">
        <h1>LxWeb Prototype</h1>

        <h2>Engine</h2>

        <canvas id="canvas" width="512" height="288" style="border: 1px solid #CCC; box-shadow: 3px 3px 6px #EEE;"></canvas>
        <br />
        <audio id="audio" preload="auto" autobuffer>
            <source src="TheCity01_0.ogg" />
        </audio>
        <div>
            <a href="#" onclick="$('#audio')[0].pause()" style="font-size: 80%; color: Gray; font-style: italic;">mute</a>
        </div>

        <h2>Credits</h2>
        <ul>
            <li><strong>Music</strong>: <a href="http://opengameart.org/content/creepy-backround-music">&quot;The City&quot; by Mumu</a></li>
        </ul>


        <script type="text/javascript">
        <!--
        var engine;

        var state =
        {
            _entities : [],

            init: function (gametime) {
            },
            update: function (gametime) {
            },
            draw: function (ctx, gametime) {
                ctx.clearRect(0, 0, 512, 288);
                for (var i in this._entities) {
                    var entity = this._entities[i];
                    if (entity.lifetime === undefined || (entity.lifetime.start <= gametime && entity.lifetime.end > gametime))
                    {
                        entity.draw(ctx, gametime);
                    }
                }
            },
        };

        state._entities.push({
            draw :function (ctx, gametime)
            {
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, 512, 288);
            },
        });

        function textEntity(st, fadeInTm, fullTm, fadeOutTm, x, y, s)
        {
            return {
                lifetime : {
                    start : st,
                    end : st + (fadeInTm + fullTm + fadeOutTm),
                },
                draw :function (ctx, gametime)
                {
                    var time = gametime - this.lifetime.start;

                    if (time < fadeInTm)
                    {
                        a = easeIn(time / fadeInTm);
                    }
                    else
                    {
                        time -= fadeInTm;
                        if (time < fullTm)
                        {
                            a = 1.0;
                        }
                        else
                        {
                            time -= fullTm;
                            a = easeIn2(1 - time / fadeOutTm);
                        }
                    }

                    ctx.font = "small-caps 32px Serif";
                    ctx.fillStyle = "rgba(255,255,255," + a + ")";
                    ctx.fillText(s, x, y);
                }
            };
        }

        state._entities.push(textEntity(  750, 3000, 4000, 2000, 16, 288 - 16, "Night's Return:"));
        state._entities.push(textEntity( 3750, 2000, 2000, 2000, 226, 288 - 16, "Brigand"));
        state._entities.push(textEntity(10000, 1000, 2000, 1000, 16, 288 - 16, "Produced with LxEngine"));

        

        function easeIn(x) {
            return Math.sin(x * Math.PI / 2);
        }
        function easeIn2(x) {
            return easeIn(easeIn(x));
        }


        $(document).ready(function () {
            var ctx = $("#canvas")[0].getContext('2d');

            var gametime = 0;
            var gametick = 20;

            function gameLoop() {
                state.draw(ctx, gametime);
                gametime += gametick;
                window.setTimeout(gameLoop, gametick);
            };
            $("#audio")[0].play();
            state.init(gametime);
            window.setTimeout(gameLoop, gametick);

        });
        -->
        </script>

        <!-- Google Analytics -->         <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-604613-10']);
            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();        </script> 

    </body>
</html>
